<!doctype html>


<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<title>Category</title>

	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="/styles/main.css" />
	<link rel="stylesheet" type="text/css" href="/styles/content.css" />
	<link rel="stylesheet" type="text/css" href="/styles/microsoft.css" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body class="category">
	<header>
		<nav>
			<input class="trigger" type="checkbox" id="hamburger" />
			<a class="github" href="https://github.com/DamSenViet/LAHacks-Improved"><img src="/icons/github.svg"/></a>
			<a class="logo" href="/">Browse</a>
			<label class="right hamburger center-parent mobile" for="hamburger">
					<div class="center">
						<div class="top bar"></div>
						<div class="middle bar"></div>
						<div class="bottom bar"></div>
					</div>
				</label>

			<div class="menu-items">
				<div class="search">
					<input type="text" list="suggestions" placeholder="Search..." />

					<datalist id="suggestions">
							<option value="wow"></option>
						</datalist>
				</div>

				<a class="main" href="/login.html"><span class="centered-text">Login</span></a>
				<a class="main" href="/signup.html"><span class="centered-text">Sign Up</span></a>

				<!-- <div class="dropdown settings">
						<a class="main">DamSenViet</a>
						<ul>
							<li><a class="user-icon">Profile</a></li>
							<li><a class="gear-icon">Settings</a></li>
						</ul>
					</div> -->


				<div class="dropdown categories">
					<a class="main desktop">Categories</a>
					<ul class="desktop">
						<li><a href="test">cats</a></li>
						<li><a>dogs</a></li>
						<li><a>thing</a></li>
						<li><a>wow</a></li>
					</ul>

					<div class="select-wrapper mobile">
						<select>
								<option disabled selected hidden>Categories</option>
								<option value="1">cats</option>
								<option value="2">dogs</option>
								<option value="3">humans</option>
								<option value="4">robots</option>
							</select>
					</div>
				</div>

			</div>
		</nav>
	</header>

	<main class="category">
		<div class="close-out">
			<div class="bar"></div>
			<div class="bar"></div>
		</div>

		<div class="card" data-post-id="10">
			<div class="image-container">
				<div class="overlay-container">
					<div class="image" style="background-image: url(https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRNUfw2-C8A1-mU9DFA_yHTVf9bYy2ZYX7twQsjAhTPqmmi-pUP)">
					</div>

					<div class="content">
						<div class="title">
							Wallpapers
						</div>
						<div class="like-wrapper">
							<input id="post-id" type="checkbox" class="like-input"/>
							<label for="post-id" class="like-button"></label>
						</div>

						<div class="author">
							by <a class="author-name" href="">Mahdi</a>
						</div>
						<div class="description">
							A bunch of wallpapers I picked up last month.
						</div>


						<div class="comments">
							<div class="comment-thread">
								<div class="comment">
									<div class="comment-author">
										<a class="username" href="">Akashkutappa</a>
									</div>
									<p class="comment-text">
										Test text
									</p>
								</div>

								<div class="comment">
									<div class="comment-author">
										<a class="username" href="">DamSenViet</a>
									</div>
									<p class="comment-text">
										Great work! But don't you think the interaction of the user to close the card isn't self explanatory ? A user would generally click the card again to probably view the image or expand on the information provided
									</p>
								</div>
							</div>
							<div>
								<span class="view-more-comments">View more comments...</span>
							</div>
							<textarea class="reply post-reply" placeholder="Write a comment..." rows="1"></textarea>
						</div>
					</div>



				</div>
				<!-- can't use image otherwise need more js -->
			</div>
		</div>

		<div class="card">
			<div class="image-container">
				<div class="overlay-container">
					<div class="image" style="background-image: url(https://images.unsplash.com/photo-1522931698295-e7b4d3e4188f?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=309ec01234d4c837205b8e994a26b501&auto=format&fit=crop&w=934&q=80)"></div>

					<div class="content">
						<div class="title">
							Diving
						</div>
						<div class="description"></div>
						<div class="comments">


						</div>
					</div>

				</div>
			</div>
		</div>

		<div class="card">
			<div class="image-container">
				<div class="overlay-container">
					<div class="image" style="background-image: url(https://images.unsplash.com/photo-1501681506726-610246d81ade?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=8913b1d2259602423f7c5ebafbd0d35a&auto=format&fit=crop&w=500&q=60)"></div>

					<div class="content">
						<div class="title">
							Buildings
						</div>
						<div class="description"></div>
						<div class="comments">
						</div>
					</div>

				</div>
			</div>
		</div>


		<div class="card">
			<div class="image-container">
				<div class="overlay-container">
					<div class="image" style="background-image: url(https://images.unsplash.com/photo-1522901164215-21e2c3f4deb2?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=e3e94da2d4ad11205b6fc6af8849b336&auto=format&fit=crop&w=1268&q=80)"></div>

					<div class="content">
						<div class="title">
							Structures
						</div>
						<div class="description"></div>
						<div class="comments">
						</div>
					</div>

				</div>
			</div>
		</div>



		<div class="card">
			<div class="image-container">
				<div class="overlay-container">
					<div class="image" style="background-image: url(https://images.unsplash.com/photo-1485340140625-c6edf4b069d6?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=1600a41c495b1aa397fb3f9e8f45ddd3&auto=format&fit=crop&w=500&q=60)">
					</div>

					<div class="content">
						<div class="title">
							Photo Editing
						</div>
						<div class="description"></div>
						<div class="comments">
						</div>
					</div>

				</div>
			</div>
		</div>


		<div class="card">
			<div class="image-container">
				<div class="overlay-container">
					<div class="image" style="background-image: url(https://images.unsplash.com/photo-1502014822147-1aedfb0676e0?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=a6a4ecb663beb4222450833f23c74017&auto=format&fit=crop&w=500&q=60)"></div>

					<div class="content">
						<div class="title">
							Color
						</div>
						<div class="description"></div>
						<div class="comments">
						</div>
					</div>

				</div>
			</div>
		</div>



		<div class="card">
			<div class="image-container">
				<div class="overlay-container">
					<div class="image" style="background-image: url(https://images.unsplash.com/photo-1481386642130-4a31ef3bf00d?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=59fb10afb12965d26ac1dfcd110b3cff&auto=format&fit=crop&w=500&q=60)"></div>

					<div class="content">
						<div class="title">
							Stairs
						</div>
						<div class="description"></div>
						<div class="comments">
						</div>
					</div>

				</div>
			</div>
		</div>

		<div class="card">
			<div class="image-container">
				<div class="overlay-container">
					<div class="image" style="background-image: url(https://images.unsplash.com/photo-1522897355400-c4fdec73d979?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=cf638e454f0b741812a40edc5df77086&auto=format&fit=crop&w=800&q=60)"></div>

					<div class="content">
						<div class="title">
							Everyday Carry
						</div>
						<div class="description"></div>
						<div class="comments">
						</div>
					</div>

				</div>
			</div>
		</div>

		<div class="floating-add">
			<img src="/icons/camera.svg" class="icon" />
		</div>
	</main>

	<script>
		function whichTransitionEvent() {
			var el = document.createElement('fakeelement');
			var transitions = {
				'transition': 'transitionend',
				'OTransition': 'oTransitionEnd',
				'MozTransition': 'transitionend',
				'WebkitTransition': 'webkitTransitionEnd'
			}

			for (var t in transitions) {
				if (el.style[t] !== undefined) {
					return transitions[t];
				}
				return transitions['transition'];
			}
		}
		var transitionEnd = whichTransitionEvent();


		$('.floating-add').click(function() {
			setTimeout(function() {
				window.location.href = '/upload.html';
			}, 200);
		});


		function animate(card) {
			// FIRST position before transform
			// LAST position after transform
			let first;
			let last;
			if (!$(card).hasClass('active')) {
				// reset all other animation states
				$('.card').removeClass('animate final');

				// adding active
				first = card.getBoundingClientRect();
				$(card).addClass('active');
				$('body').addClass('active');
				last = card.getBoundingClientRect();

				// add placeholder element
				var emptyCard = "<div class='card placeholder'><div class='image-container'><div class='overlay-container'><div class='image'></div><div class='content'></div></div></div></div>"
				$(emptyCard).insertAfter(card);

			} else {
				// delete placeholder first to make sure first and last are correct
				$('.placeholder').remove();

				// removing active using image instead
				// prevents image distortion
				let image =  card.querySelector('.image');
				first = image.getBoundingClientRect();
				$(card).removeClass('active');
				$('body').removeClass('active');
				last = image.getBoundingClientRect();
			}


			// get current position and scales
			let invert = {
				// position
				x: first.left - last.left,
				y: first.top - last.top,
				// scales
				sx: first.width / last.width,
				sy: first.height / last.height
			};

			// transforms to the current position according to scaling
			card.style.transform = 'translate(' + invert.x + 'px, ' + invert.y + 'px) scale(' + invert.sx + ', ' + invert.sy + ')';

			// PLAY
			window.requestAnimationFrame(function() {
				card.classList.add('animate');
				// reset transform to have it move back into its proper place
				card.style.transform = "";

				// activating card, add final state in the middle of 'animate'
				if (card.classList.contains('active')) {
					card.classList.add('final');
				}

				// CLEAR, moves to desired position once animate transition ends
				card.addEventListener(transitionEnd, clearCardAnimation);
			});
		};

		// CLEAR ANIMATION PHASE
		function clearCardAnimation(event) {
			this.classList.remove('animate');
			this.removeEventListener(transitionEnd, clearCardAnimation);
		};

		// ATTACH HANDLER WHEN NO CARDS ARE ACTIVE
		// REMOVE HANDLER WHEN ONE CARD ACTIVE
		var scrollPos = null;
		var attachFocusToCards = function() {
			$('.card').click(function() {
				// remove handler from all cards after clicking, continue
				$('.card').unbind();
				try {
					// animate the clicked card
					animate(this);
				} catch (err) {return null;}
			});
		};


		$('.close-out').click(function() {
			let activeCard = document.querySelector('.card.active');

			// clearCardAnimation manually for high speed error correction
			// when close out is activated too fast, before clearCardAnimation activates
			// from transitionEnd, animate will stay there forever b/c it's never
			// cleared, even in consecutive calls, therefore need to manually clear transitionEnd
			try {
				activeCard.removeEventListener(transitionEnd, clearCardAnimation);
				// need this to kill left behind placeholder bug
				$('.card').removeClass('animate final');
			} catch (error) {return null;}

			// remove final first before inducing animation
			animate(activeCard);
			attachFocusToCards();

			// remove focus from inputs inside the card
			$('.reply').blur();
		});

		$(document).keyup(function(e) {
			if (e.keyCode == 27) {
				$('.close-out').click();
			}
		});

		// PREVENT EVENT BUBBLING FROM TRIGGERING TRANSITION END OF PARENT ('.CARD')
		// prevents some race conditions
		$('.card > *').on('transitionend', function(event) {
			event.stopImmediatePropagation();
		});
		// INITIAL ATTACHMENT
		attachFocusToCards();

		function textAreaAutoAdjust(event) {
			this.style.height = '';
			this.style.height = this.scrollHeight + 'px';
		}
		$('textarea.reply').on('input', textAreaAutoAdjust);

		function textAreaCommentKeys(event) {
			// ctrl + enter -> newline
			if (event.ctrlKey && event.keyCode ==13) {
				event.preventDefault();
				this.value += "\n";
				$(this).trigger('input');
			}
			// enter -> send comment
			else if (event.keyCode == 13) {
				event.preventDefault();
				// send out comment POST request
			}
		}
		$('textarea.reply').on('keydown', textAreaCommentKeys)



		// prevent event bubbling + ensure smooth animation
		function disableLike(event) {
			event.stopImmediatePropagation();
			//disable clicking until animation has finished
			$(this).unbind('click');
			$(this).on('click', function(event){
				event.stopImmediatePropagation();
				event.preventDefault();
			});

			// reenable like after animation completes
			// since this is a label, the input DOESN'T change checked state until after
			// this click trigger has finished running
			let resetTime = 0;
			if ($(this).siblings('.like-input').prop('checked') === true) {
				resetTime = 205
			} else if ($(this).siblings('.like-input').prop('checked') === false) {
				resetTime = 305
			}
			let likebutton = this; // outside reference, this context lost in setTimeout
			setTimeout(function(event) {
				$(likebutton).unbind();
				$(likebutton).on('click', disableLike);
			}, resetTime);
		}
		$('.like-button').on('click', disableLike);



		$('.like-input').click(function(event) {
			event.stopImmediatePropagation();
		});
		$('.like-input').change(function(event) {
			console.log(this.checked);
			// send like request

		});



		var cardsOffSet = 0;
		// postId (string) -> commentOffSet
		var commentsOffSet = {};
		function addCards() {

		}


		// "start": "rm -r ./public/pictures/* && mysql -u root -p < ./mysql/initialize.sql && rm -r ./public/pictures/* && node ./bin/www"
	</script>
	<script src="/scripts/main.js"></script>
</body>

</html>
